<!DOCTYPE html>
<html>
<head>
    <title>☭ USSR Economy Simulator ☭</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #111;
            color: #eee;
            padding: 20px;
        }
        .section {
            border: 1px solid #555;
            padding: 10px;
            margin-bottom: 10px;
        }
        button, select {
            margin: 4px;
        }
        .met {
            color: lightgreen;
            font-weight: bold;
        }
        .not-met {
            color: red;
        }
        #warning {
            color: orange;
            font-weight: bold;
            margin-top: 10px;
            display: none;
        }
        #policyEffects {
            margin-top: 10px;
            font-style: italic;
            color: #ccc;
        }
    </style>
</head>
<body>
    <h1>☭ USSR Economy Simulator ☭</h1>

    <div class="section">
        <h2>Choose Policy</h2>
        <select id="policySelect" onchange="selectPolicy()">
            <option value="none">-- Select Policy --</option>
            <option value="marxism">Marxism</option>
            <option value="stalinism">Stalinism</option>
            <option value="maoism">Maoism</option>
            <option value="anarcho">Anarcho-Communism</option>
            <option value="leninism">Leninism</option>
            <option value="trotskyism">Trotskyism</option>
            <option value="kronstadtism">Kronstadtism</option>
        </select>
        <p>Current Policy: <strong id="currentPolicy">None</strong></p>
        <p id="policyEffects"></p>
    </div>

    <div class="section">
        <h2>Stats</h2>
        <p>Manpower: <span id="manpower">0</span></p>
        <p>Workers: <span id="workers">0</span></p>
    </div>

    <div class="section">
        <h2>Hire Workers</h2>
        <button onclick="hireWorker()">Hire Worker (Cost: <span id="workerCost">10</span> manpower)</button>
    </div>

    <div class="section">
        <h2>Assign Workers</h2>
        <p>Unassigned Workers: <span id="unassigned">0</span></p>

        <p>Steel: <span id="steel">0</span> 
            <button onclick="assignWorker('steel')">+1</button> 
            <button onclick="unassignWorker('steel')">-1</button>
            (Assigned: <span id="steelWorkers">0</span>)
        </p>

        <p>Food: <span id="food">0</span> 
            <button onclick="assignWorker('food')">+1</button> 
            <button onclick="unassignWorker('food')">-1</button>
            (Assigned: <span id="foodWorkers">0</span>)
        </p>

        <p>Oil: <span id="oil">0</span> 
            <button onclick="assignWorker('oil')">+1</button> 
            <button onclick="unassignWorker('oil')">-1</button>
            (Assigned: <span id="oilWorkers">0</span>)
        </p>
    </div>

    <div class="section">
        <h2>📋 Daily Quota</h2>
        <p>Day: <span id="dayCount">1</span></p>
        <ul>
            <li>Steel: <span id="quotaSteel">0</span>/<span id="targetSteel">100</span></li>
            <li>Food: <span id="quotaFood">0</span>/<span id="targetFood">80</span></li>
            <li>Oil: <span id="quotaOil">0</span>/<span id="targetOil">50</span></li>
        </ul>
        <p id="quotaStatus" class="not-met">🚫 Quota Not Met</p>
        <p id="warning"></p>
    </div>

    <script>
        let manpower = 0;
        let workers = 0;
        let unassignedWorkers = 0;

        let steel = 0, food = 0, oil = 0;
        let steelWorkers = 0, foodWorkers = 0, oilWorkers = 0;

        let day = 1;
        let quotaSteel = 0, quotaFood = 0, quotaOil = 0;
        let baseTargetSteel = 100, baseTargetFood = 80, baseTargetOil = 50;
        let targetSteel = baseTargetSteel, targetFood = baseTargetFood, targetOil = baseTargetOil;

        let policy = "none";
        let prodMultiplier = 1;
        let workerCost = 10;
        let manpowerGain = 5;
        let quotaMultiplier = 1;

        function display(value) {
            return (value > 0 && value < 0.01) ? "0.01" : value.toFixed(2);
        }

        function updateUI() {
            document.getElementById("manpower").innerText = display(manpower);
            document.getElementById("workers").innerText = workers;
            document.getElementById("unassigned").innerText = unassignedWorkers;
            document.getElementById("steel").innerText = display(steel);
            document.getElementById("food").innerText = display(food);
            document.getElementById("oil").innerText = display(oil);
            document.getElementById("steelWorkers").innerText = steelWorkers;
            document.getElementById("foodWorkers").innerText = foodWorkers;
            document.getElementById("oilWorkers").innerText = oilWorkers;
            document.getElementById("quotaSteel").innerText = display(quotaSteel);
            document.getElementById("quotaFood").innerText = display(quotaFood);
            document.getElementById("quotaOil").innerText = display(quotaOil);
            document.getElementById("targetSteel").innerText = targetSteel;
            document.getElementById("targetFood").innerText = targetFood;
            document.getElementById("targetOil").innerText = targetOil;
            document.getElementById("dayCount").innerText = day;
            document.getElementById("currentPolicy").innerText = policy.charAt(0).toUpperCase() + policy.slice(1);
            document.getElementById("workerCost").innerText = workerCost;

            // Show if quota met or not
            const met = quotaSteel >= targetSteel && quotaFood >= targetFood && quotaOil >= targetOil;
            const status = document.getElementById("quotaStatus");
            status.innerText = met ? "✅ Quota Met! Glory to the Motherland!" : "🚫 Quota Not Met";
            status.className = met ? "met" : "not-met";
        }

        function hireWorker() {
            if (manpower >= workerCost) {
                manpower -= workerCost;
                workers++;
                unassignedWorkers++;
                updateUI();
            }
        }

        function assignWorker(res) {
            if (unassignedWorkers <= 0) return;
            unassignedWorkers--;
            if (res === 'steel') steelWorkers++;
            if (res === 'food') foodWorkers++;
            if (res === 'oil') oilWorkers++;
            updateUI();
        }

        function unassignWorker(res) {
            if (res === 'steel' && steelWorkers > 0) { steelWorkers--; unassignedWorkers++; }
            if (res === 'food' && foodWorkers > 0) { foodWorkers--; unassignedWorkers++; }
            if (res === 'oil' && oilWorkers > 0) { oilWorkers--; unassignedWorkers++; }
            updateUI();
        }

        function selectPolicy() {
            policy = document.getElementById("policySelect").value;

            // Reset modifiers
            prodMultiplier = 1;
            workerCost = 10;
            manpowerGain = 5;
            quotaMultiplier = 1;

            let effectsText = "";

            switch(policy) {
                case "marxism":
                    prodMultiplier = 1.2;
                    effectsText = "📈 +20% output";
                    break;
                case "stalinism":
                    quotaMultiplier = 1.5;
                    manpowerGain = 6;
                    effectsText = "📋 +50% quotas, 👨‍🌾 +6 manpower/tick";
                    break;
                case "maoism":
                    workerCost = 1;           // Worker cost is 1 manpower
                    manpowerGain = 2.5;       // +2.5 manpower/tick
                    prodMultiplier = 0.675;   // -32.5% production (1 - 0.325)
                    effectsText = "➖ Worker cost 1 manpower, 👨‍🌾 +2.5 manpower/tick, -32.5% output, Food production at 100%";
                    break;
                case "anarcho":
                    quotaMultiplier = 0; // no quotas
                    effectsText = "🚫 No quotas, +50% food production, -50% oil production";
                    break;
                case "leninism":
                    prodMultiplier = 1.1;
                    effectsText = "📈 +10% output";
                    break;
                case "trotskyism":
                    prodMultiplier = 1.3;
                    manpowerGain = 4;
                    effectsText = "🚀 +30% output, 👨‍🌾 -1 manpower/tick";
                    break;
                case "kronstadtism":
                    manpowerGain = 8;
                    prodMultiplier = 1; // no nerf now
                    effectsText = "👨‍🌾 +8 manpower/tick, ⚔️ No production penalty";
                    break;
                default:
                    effectsText = "";
            }

            // Apply quotas
            targetSteel = Math.floor(baseTargetSteel * quotaMultiplier);
            targetFood = Math.floor(baseTargetFood * quotaMultiplier);
            targetOil = Math.floor(baseTargetOil * quotaMultiplier);

            document.getElementById("policyEffects").innerText = effectsText;

            updateUI();
        }

        // Game loop - every second
        setInterval(() => {
            manpower += manpowerGain;

            let steelGain = steelWorkers * prodMultiplier;
            let foodGain = foodWorkers * prodMultiplier;
            let oilGain = oilWorkers * prodMultiplier;

            // Maoism: food is always at 100% production (no reduction)
            if (policy === "maoism") {
                foodGain = foodWorkers * 1; // full 100%
            }

            // Anarcho special production
            if (policy === "anarcho") {
                foodGain *= 1.5;
                oilGain *= 0.5;
            }

            steel += steelGain;
            food += foodGain;
            oil += oilGain;

            quotaSteel += steelGain;
            quotaFood += foodGain;
            quotaOil += oilGain;

            updateUI();
        }, 1000);

        // New day every 60s
        setInterval(() => {
            day++;

            // Clear warning at day start
            const warningEl = document.getElementById("warning");
            warningEl.style.display = "none";
            warningEl.innerText = "";

            // Check overproduction and apply 50% excess penalty
            const checkOverQuota = (actual, target) => {
                if (actual >= target * 2.5) {
                    let excess = actual - target;
                    return Math.floor(excess * 0.5); // 50% of excess
                }
                return 0;
            };

            let steelPenalty = checkOverQuota(quotaSteel, targetSteel);
            let foodPenalty = checkOverQuota(quotaFood, targetFood);
            let oilPenalty = checkOverQuota(quotaOil, targetOil);

            let penaltyOccurred = steelPenalty > 0 || foodPenalty > 0 || oilPenalty > 0;

            // Remove resources and increase base quota
            steel = Math.max(0, steel - steelPenalty);
            food = Math.max(0, food - foodPenalty);
            oil = Math.max(0, oil - oilPenalty);

            baseTargetSteel += 10 + steelPenalty;
            baseTargetFood += 10 + foodPenalty;
            baseTargetOil += 5 + oilPenalty;

            // Reset daily quotas
            quotaSteel = 0;
            quotaFood = 0;
            quotaOil = 0;

            // Re-apply multiplier for policy effect
            selectPolicy();

            if (penaltyOccurred) {
                warningEl.style.display = "block";
                warningEl.innerText = "⚠️ Commissar demands more due to surplus! Daily quotas increased.";
            }

            updateUI();
        }, 60000);

        updateUI();
    </script>
</body>
</html>
